<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: bootstrap.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: bootstrap.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const promiseAdapter = require('./promiseAdapter');
const clientService = require('./clientService');

/**
 * Deducts amount from customer's balance 
 * @param {string} refID - ReferenceID. or Corelation ID
 * @param {string} msisdn 
 * @param {float} amount - Amount in Rupees
 * @param {string} remarks - e.g. Bundle_gifting
 * @returns {object} {statusCode, message}
 */
exports.deductFromBalance = async(refID, msisdn, amountInRs, remarks) =>{
    try {
        //TODO: call charging service 
        return promiseAdapter.resolve({
            statusCode: "200",
            message: "",
            data: {}
        })
        /** 
        let result = clientService.restRequest(
            'POST',
        )
        */
    } catch (error) {
        return promiseAdapter.reject(error);
    }
}

/** 
 * Deduct amount from Easypaisa Mobile account
 * @returns {object} - {statusCode: 200, message: } or error reject promise
 * 
*/
exports.deductFromEPMA = async (refID, msisdn, amountInRs, email, ipnAction, appVersion, channel, mobile_account) => {
    try {
        _headers = {
            "content-type": "application/json",
            "Authorization": process.env.PAYMENTSERVICE_APIKEY,
            "requestId": refID,
            "channel": channel
        };

        _body = {
            msisdn : msisdn,
            orderID : refID,
            amount : amountInRs,
            email : email,
            ipnAction: ipnAction,
            appVersion : appVersion || 'WEB', 
            channel : channel , 
            mobile_account : mobile_account // mobile_account will be same as msisdn
        };

        let url = `${process.env.PAYMENT_SERVICE_BASE_URL}/easypaisa/ma/deduct`;

        let result = await clientService.restRequest('POST', url, _body, _headers, false, 120000 );

        return result;

    } catch (error) {
        return promiseAdapter.reject(error);
    }
}

/** 
 * @typedef allowances {array} - Array of objects
 * @property {string} label - The label @example "Offnet minutes"
 * @property {string} measure_unit @example "mbs"
 */

/** 
 * @param validityInDays {string} - Allowances validity in days
 * @param allowances {allowances}
*/
exports.postAllowances = async (msisdn, validityInDays, allowances, remarks_prefix) => {
    try {
        _headers = {
            "content-type": "application/json",
            "Authorization": process.env.CUSTOM_CHARGING_POSTING_MICROSERVICE_ACCESSKEY,
            "requestId": refID,
        };

        _body = {
            "validity": "1",
            "msisdn": "03498126921",
            "allowances":[
                {
                    "label": "Offnet minutes",
                    "measure_unit": "minutes",
                    "id": "5178",
                    "allowance": 30
                }
            ],
            "remarks_prefix":"playandwin"
        }

        let result = clientService.restRequest('POST', process.env.SERVICE_CUSTOM_ALLOWANCE_POSTING_BASE_URL)

    } catch (error) {
        return promiseAdapter.reject(error);
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#deductFromBalance">deductFromBalance</a></li><li><a href="global.html#deductFromEPMA">deductFromEPMA</a></li><li><a href="global.html#postAllowances">postAllowances</a></li><li><a href="global.html#restRequest">restRequest</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Mar 23 2020 13:05:58 GMT+0500 (Pakistan Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
